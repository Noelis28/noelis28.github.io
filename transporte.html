<!doctype html> 
<html lang="en">
<head>
  <meta charset="UTF-8"> <!--  --> 
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
  >
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <title>EcoHuella - Transporte</title>
</head>
<body>
  <header class="header">
    <div class="header__text">
      <h1>Descubre tu Huella de Carbono con EcoHuella</h1>
      <p>¡Calcula, reduce y salva el planeta! Responde preguntas simples sobre tu estilo de vida y obtén consejos personalizados para un futuro sostenible.</p>
    </div>
  </header>
  <main>
    {% block content %}
    <h2 class="main__title">¿Cómo te desplazas diariamente? Selecciona tu opción principal</h2>


    <form id="transporte-form" action="/calcular_transporte" method="POST">  <!-- <--  formulario que envía datos a la ruta /calcular_transporte -->
      <!-- Pregunta 1 -->
      <h3>¿Usas bicicleta o caminas para distancias cortas?</h3>
      <div class="question">
        <label><input type="radio" name="bicicleta" value="si"><img src="../static/img/si.png" alt="Sí"><span>Sí</span></label>
        <label><input type="radio" name="bicicleta" value="no"><img src="../static/img/no.png" alt="No"><span>No</span></label>
      </div>

      <!-- Pregunta 2 -->
      <h3>¿Usas transporte público (autobús, metro, tren)?</h3>
      <div class="question">
        <label><input type="radio" name="publico" value="si"><img src="../static/img/si.png" alt="Sí"><span>Sí</span></label>
        <label><input type="radio" name="publico" value="no"><img src="../static/img/no.png" alt="No"><span>No</span></label>
      </div>

      <!-- Pregunta 3 -->
      <h3>¿Usas carro propio la mayoría de los días?</h3>
      <div class="question">
        <label><input type="radio" name="carro" value="si"><img src="../static/img/si.png" alt="Sí"><span>Sí</span></label>
        <label><input type="radio" name="carro" value="no"><img src="../static/img/no.png" alt="No"><span>No</span></label>
      </div>

      <!-- Pregunta 4 -->
      <h3>¿Cuántos km viajas al día en promedio?</h3>
      <div class="question">
        <label><input type="radio" name="km" value="bajo"><img src="../static/img/kilometraje.png" alt="Sí"><span>Menos de 20 km</span></label>
        <label><input type="radio" name="km" value="medio"><img src="../static/img/kilometraje.png" alt="No"><span>20-40 km</span></label>
        <label><input type="radio" name="km" value="alto"><img src="../static/img/kilometraje.png" alt="No"><span>Más de 40 km</span></label>
      </div>

      <!-- Pregunta 5 -->
      <h3>¿Compartes viajes (carpooling) para reducir emisiones?</h3>
      <div class="question">
        <label><input type="radio" name="carpooling" value="si"><img src="../static/img/si.png" alt="Sí"><span>Sí</span></label>
        <label><input type="radio" name="carpooling" value="no"><img src="../static/img/no.png" alt="No"><span>No</span></label>
      </div>
    </form> 
    {% endblock %}
  </main>

  <!-- Botón "Calcular" oculto inicialmente -->
  <button id="calcular-btn" type="submit" form="transporte-form">Calcular</button>



  <script>
    // Función para verificar si todas las preguntas están respondidas
    function checkForm() {
      const questions = document.querySelectorAll('.question'); // Selecciona todas las preguntas
      let allAnswered = true; // verificar si todas están respondidas
      questions.forEach(q => { // para cada pregunta
        const radios = q.querySelectorAll('input[type="radio"]'); // selecciona los radio buttons
        const checked = Array.from(radios).some(r => r.checked); // verifica si alguno está seleccionado
        if (!checked) allAnswered = false; // si alguno no está seleccionado, marca como no respondido
      });
      const btn = document.getElementById('calcular-btn'); // aparece el botón calcular
      if (allAnswered) { // si todas están respondidas
        btn.classList.add('visible'); // muestra el botón
      } else {
        btn.classList.remove('visible'); // oculta el botón
      }
    }

    // Función para manejar la selección persistente
    function handleSelection() {
        // Remueve el selected de todos los labels en la misma pregunta
        const allLabels = document.querySelectorAll('.question label'); 
        allLabels.forEach(label => label.classList.remove('selected'));
        // remueve el selected de las opciones no elegidas

        // Agregar 'selected' al label del radio button checked
        // resalta la opción escogida
        const checkedRadios = document.querySelectorAll('.question input[type="radio"]:checked'); 
        checkedRadios.forEach(radio => { 
            const label = radio.closest('label'); // Encuentra el label principal del radio marcado
            if (label) label.classList.add('selected'); // agrega la clase selected al label para resaltar
        });
    }

    // Agregar event listeners a todos los radio buttons
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', () => { // cuando cambia la selección de un label o radio
          handleSelection(); //actualiza la selección y resaltado
          checkForm(); //verifica si todas estan respondidas
      });
    });

    // Verificar al cargar la página, revisa si ya hay opciones seleccionadas
    window.addEventListener('load', () => { // cuando se carga la página
        handleSelection(); //actualiza la selección
        checkForm(); //verifica si todas estan respondidas
    });
  </script>
</body>
</html>